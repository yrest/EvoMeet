# TURNS (TURN over TLS/TCP) on port 5349
# nginx stream SNI-routes turn.personahub.app:443 → host:5349
tls-listening-port=5349

# TLS certificates for turn.personahub.app
cert=/etc/letsencrypt/live/turn.personahub.app/fullchain.pem
pkey=/etc/letsencrypt/live/turn.personahub.app/privkey.pem

# Realm and auth
realm=turn.personahub.app
user=videocall:387363fac8bd483df102843e12b05c1d9ae708af

# Azure NATs 20.233.97.125 → 172.16.0.4 (eth0 private IP).
# Relay sockets MUST bind on 172.16.0.4 so that hairpin relay between two
# peers on the same server goes: 172.16.0.4:PORT_A → 172.16.0.4:PORT_B
# (kernel loopback on the same host, never exits to the internet).
# Without relay-ip, coturn binds relay on all interfaces and sends to
# 20.233.97.125:PORT which leaves the VM and is dropped by Azure NAT.
relay-ip=172.16.0.4
external-ip=20.233.97.125/172.16.0.4

# Plain TURN on UDP 443 — low-latency path when the network passes UDP.
# no-tcp prevents coturn from competing with nginx for TCP 443.
# Note: ensure inbound UDP 443 is allowed in the server firewall / NSG.
listening-port=443
no-tcp

# Disable DTLS — only TCP/TLS (TURNS) on port 5349
no-dtls

# Security
fingerprint
lt-cred-mech
no-multicast-peers
no-cli

# Relay port range — stays within the host (hairpin), no NSG rules needed
min-port=49152
max-port=65535

# Deny relay to private ranges (SSRF protection).
# 172.16.0.0/12 is intentionally omitted: 172.16.0.4 is our own relay-ip
# and the peer address clients specify is 20.233.97.125 (public, not denied).
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=192.168.0.0-192.168.255.255

# Logging
log-file=stdout
verbose
